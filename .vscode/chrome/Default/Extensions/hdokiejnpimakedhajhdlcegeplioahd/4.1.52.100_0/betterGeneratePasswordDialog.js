var BetterGeneratePasswordDialog=function(e){VaultItemDialog.call(this,e,{additionalHeaderClasses:["icon","leftIcon"],dynamicHeight:!0,hideHeader:!1,responsive:!1,title:Strings.translateString("Generate"),confirmOnClose:!1,overlayDialog:!0,hideButtons:!0})};BetterGeneratePasswordDialog.prototype=Object.create(Dialog.prototype),BetterGeneratePasswordDialog.prototype.constructor=BetterGeneratePasswordDialog,BetterGeneratePasswordDialog.prototype.open=function(e){e=$.extend(e,{defaultData:{length:bg.Preferences.get("generate_length"),uppercase:bg.Preferences.get("generate_upper"),lowercase:bg.Preferences.get("generate_lower"),numeric:bg.Preferences.get("generate_digits"),special:bg.Preferences.get("generate_special"),avoidAmbiguous:bg.Preferences.get("generate_ambig"),pronounceable:bg.Preferences.get("generate_pronounceable")}}),!0===e.defaultData.avoidAmbiguous&&!0===e.defaultData.pronounceable&&(e.defaultData.avoidAmbiguous=!1),Dialog.prototype.open.call(this,e)},BetterGeneratePasswordDialog.prototype.configureEasyToSay=function(e){return this.inputFields.numeric.setValue(!e),this.inputFields.special.setValue(!e),e?(this.inputFields.numeric.disable(),this.inputFields.special.disable(),this.inputFields.pronounceable.setValue(!0),this.inputFields.avoidAmbiguous.setValue(!1)):(this.inputFields.numeric.enable(),this.inputFields.special.enable()),!1},BetterGeneratePasswordDialog.prototype.configureEasyToRead=function(e){return e&&(this.inputFields.numeric.enable(),this.inputFields.special.enable(),this.inputFields.avoidAmbiguous.setValue(!0),this.inputFields.pronounceable.setValue(!1)),!1},BetterGeneratePasswordDialog.prototype.updateLength=function(e){return this.inputFields.length.getValue()!==e&&this.inputFields.length.setValue(e),this.inputFields.lengthInput.getValue()!==e&&this.inputFields.lengthInput.setValue(e),$("#sliderFill").width(e+"%"),!1},BetterGeneratePasswordDialog.prototype.initialize=function(){Dialog.prototype.initialize.apply(this,arguments),this.inputFields.password.getElement().LP_addPasswordMeter(null,null,!0),LPFeatures.allowClipboardCopy()||($("#copyPassword").LP_hide(),$("#fillPasswordButton").LP_hide()),function(e){if(e.inputFields.password.getElement().on("copy",function(){e.setCopiedGeneratedPassword(e.inputFields.password.getValue())}),$(".lp-icon").hover(function(){$(".tooltiptext:animated").length<=0&&$(this).children().fadeIn()},function(){$(this).children().fadeOut()}),$("#generateButton").unbind("click"),$("#generateButton").bind("click",function(){e.submit()}),$("#showHistory").bind("click",function(){e.toggleHistory(e.data.saveOptions.source)}),$("#clearHistory").bind("click",function(){$("#historyBody").empty(),$("#historyTable").hide(),$("#historyEmptyState").show(),bg.set("g_genpws",[]),bg.sendLpImprove("historycleared",{source:e.data.saveOptions.source})}),e.minimumLength=4,bg.get("g_prefoverrides").sitepwlen){var t=parseInt(bg.get("g_prefoverrides").sitepwlen);t>e.minimumLength&&(e.minimumLength=t,$("#length").prop("min",e.minimumLength),$("#lengthInput").prop("min",e.minimumLength))}$("#length").bind("input",function(){e.setupComplete&&e.updateLength(e.inputFields.length.getValue())}),e.inputFields.lengthInput.onChange(function(){e.setupComplete&&e.updateLength(e.inputFields.lengthInput.getValue())});var s=function(){bg&&bg.sendLpImprove&&bg.sendLpImprove("copypass",{source:e.data.saveOptions.source,generatedPasswordCount:$("#generatedPasswordCount").val()});var t=e.inputFields.password.getValue();e.setCopiedGeneratedPassword(t),LPProxy.copyToClipboard(t),Topics.get(Topics.SUCCESS).publish(Strings.translateString("Password Copied")),"function"==typeof e.data.onCopy&&e.data.onCopy(),e.close()};LPPlatform.addEventListener(document.getElementById("copyPassword"),"click",s),$("#fillPasswordButton").unbind("click"),e.data.saveOptions&&"icon"===e.data.saveOptions.source?$("#fillPasswordButton").bind("click",function(){e.usePassword()}):($("#fillPasswordButton").text(Strings.Vault.COPY_PASSWORD),$("#fillPasswordButton").bind("click",s)),e.inputFields.pronounceable.onChange(function(t){e.setupComplete&&e.configureEasyToSay(t)}),e.inputFields.avoidAmbiguous.onChange(function(t){e.setupComplete&&e.configureEasyToRead(t)}),$("input[type='checkbox'],input[type='radio'],input[type='text'],input[type='range']").bind("change",function(){e.submit()})}(this)},BetterGeneratePasswordDialog.prototype.setCopiedGeneratedPassword=function(e){bg.LPTabState&&bg.LPTabState.setCopiedGeneratedPassword&&bg.LPTabState.setCopiedGeneratedPassword(e)},BetterGeneratePasswordDialog.prototype.saveState=function(){var e=this.getData();bg.Preferences.set({generate_length:e.length,generate_upper:e.uppercase,generate_lower:e.lowercase,generate_digits:e.numeric,generate_special:e.special,generate_ambig:e.avoidAmbiguous,generate_pronounceable:e.pronounceable}),this.storePassword()},BetterGeneratePasswordDialog.prototype.close=function(){return this.saveState(),Dialog.prototype.close.apply(this,arguments)},BetterGeneratePasswordDialog.prototype.toggleHistory=function(e){var t=$("#historyView"),s=$("#showHistory"),i=$("#clearHistory"),a=$("#generatePasswordDialogDropdownAdvancedOptions");"none"===t.css("display")?(a.css("display","none"),t.css("display","block"),s.text("Hide History"),i.css("display","block"),bg.sendLpImprove("historyviewed",{source:e})):(t.css("display","none"),a.css("display","block"),s.text("Show History"),i.css("display","none")),this.setDynamicHeight()},BetterGeneratePasswordDialog.prototype.setPasswordHistory=function(e){var t=$("#historyTable"),s=$("#historyBody"),i=$("#historyEmptyState");0===e.length?(t.hide(),i.show()):(s.empty(),t.show(),i.hide());for(var a=0;a<e.length;a++){var n=LPTools.createElement("tr"),o=LPTools.createElement("td","",e[a]),r=LPTools.createElement("td","",this.getReadableDate());n.appendChild(o),n.appendChild(r),s.append(n)}},BetterGeneratePasswordDialog.prototype.getReadableDate=function(){var e=new Date,t=("0"+e.getMinutes()).slice(-2),s=e.getHours(),i=e.getHours()<12?"AM":"PM";s=s>12?s-12:s,s=0===s?12:s;var a=e.getDate(),n=e.toLocaleString("en-us",{month:"long"}),o=e.getFullYear(),r=n+" "+a+", "+o,l=s+":"+t+" "+i;return Strings.translateString("%1 at %2",r,l)},BetterGeneratePasswordDialog.prototype.setup=function(e,t){t.defaultData.length<this.minimumLength&&(t.defaultData.length=this.minimumLength),Dialog.prototype.setup.apply(this,arguments),this.updateLength(t.defaultData.length),t.defaultData.avoidAmbiguous?this.configureEasyToRead(!0):this.configureEasyToSay(!0),this.setPasswordHistory(bg.get("g_genpws")||[])},BetterGeneratePasswordDialog.prototype.postSetup=function(e){Dialog.prototype.postSetup.apply(this,arguments),this.submit()},BetterGeneratePasswordDialog.prototype.storePassword=function(){var e=this.inputFields.password.getValue();if(e&&e.length>0){var t=bg.get("g_genpws")||[];t.unshift(e),t.length>20&&t.splice(20,t.length-20),bg.set("g_genpws",t),this.setPasswordHistory(t)}},BetterGeneratePasswordDialog.prototype.usePassword=function(){var e=this.inputFields.password.getValue();this.data.input?(this.data.input.val(e),this.close()):(bg.fillGeneratedPassword(this.data.tabID,this.data.tabURL,e,$.extend(this.data.saveOptions,{avoidAmbiguous:this.inputFields.avoidAmbiguous.getValue(),length:this.inputFields.length.getValue(),lowercase:this.inputFields.lowercase.getValue(),numeric:this.inputFields.numeric.getValue(),pronounceable:this.inputFields.pronounceable.getValue(),special:this.inputFields.special.getValue(),uppercase:this.inputFields.uppercase.getValue(),generatedPasswordCount:$("#generatedPasswordCount").val()})),LPPlatform.closePopup(!0)),this.saveState()},BetterGeneratePasswordDialog.prototype.handleSubmit=function(e){this.storePassword(),$("#generatedPasswordCount").val(function(){return parseInt($("#generatedPasswordCount").val())+1}),this.inputFields.password.setValue(bg.lpCreatePass(e.length,e.uppercase,e.lowercase,e.numeric,e.special,2,e.avoidAmbiguous,!0,e.pronounceable))};