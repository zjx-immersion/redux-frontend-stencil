var CardDialog=function(t){DialogWithGroupInput.call(this,t,{confirmOnClose:!1,hideButtons:!0,hideHeader:!0,type:Account,additionalClasses:"lmiDialog",additionalDropdownClasses:"lmiDropdown"}),this.tiles=[],this.activeTile=null,this.selectedTile=null,this.isSelectable=!1,this.submitted=!1};CardDialog.prototype=Object.create(DialogWithGroupInput.prototype),CardDialog.prototype.constructor=CardDialog,function(){CardDialog.prototype.initialize=function(t){DialogWithGroupInput.prototype.initialize.apply(this,arguments),function(e){e.backButton=t.find("#close").bind("click",function(){e.close()}),e.nextButton=t.find("#submit").bind("click",function(){})}(this)};var t=function(t){for(var e={},i=t.find("[dialogFieldDisplay]"),n=0;n<i.length;++n){e[i[n].getAttribute("dialogFieldDisplay")]=!0}return e},e=function(t,e){for(var i=t.find("[dialogFieldDisplay]"),n=0;n<i.length;++n){var o=i[n],r=o.getAttribute("dialogFieldDisplay"),l=e[r];if(l)switch(r){case"ccnum":o.textContent=Strings.translateString("Ending in %1",l.substr(l.length-4));break;default:o.textContent=l}else"cctype"==r&&e.ccnum&&(o.textContent=a(e.ccnum)?a(e.ccnum):"Payment card")}};CardDialog.prototype.sendTrackingEvent=function(t){},CardDialog.prototype.setupAdd=function(t){switch(t=t||this.data,t.type){case"CreditCard":this.$element.find(".question").text(Strings.translateString("Add this credit card to LastPass?")),this.nextButton.text(Strings.translateString("Add")),this.$element.find(".viewButton").text(Strings.translateString("View Details"));new this.CardTile}},CardDialog.prototype.setupUpdate=function(t){switch(t=t||this.data,t.type){case"CreditCard":this.$element.find(".question").text(Strings.translateString("Update this credit card?")),this.nextButton.text(Strings.translateString("Update"));var e="View"+(t.changesCount?" "+t.changesCount:"")+" Changes";this.$element.find(".viewButton").text(Strings.translateString(e));new this.CardTile}};var i=function(t,e,i){var n=$.extend({},t.defaultData);return e&&$.extend(n,e.getFormData($.extend(i,DialogInput.getProperties(t.dialogData),DialogInput.getProperties(t.defaultData)))),n},n=function(t,e,n){return $.extend(i(t,e,n),t.dialogData)},a=function(t){var e=new RegExp("^4");return null!=t.match(e)?"Visa":(e=new RegExp("^5[1-5]"),null!=t.match(e)?"Mastercard":(e=new RegExp("^3[47]"),null!=t.match(e)?"Amex":(e=new RegExp("^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)"),null!=t.match(e)?"Discover":"")))};CardDialog.prototype.hasDuplicates=function(){for(var t=0;t<this.tiles.length;++t)if(this.tiles[t].getDuplicates().length>0)return!0;return!1},CardDialog.prototype.setup=function(o,r){switch(r.saveOptions={source:"saveSite"},r.type){case"CreditCard":o.find(".addSiteFavicon").append(LPTools.createElement("img",{class:"favicon",src:a(r.defaultData.ccnum)?"images/"+a(r.defaultData.ccnum)+".png":"images/Other.png"}))}this.$element.find(".dialogContent");var l=this,s=o.find(".tileContainer"),d=(o.find(".question"),o.find(".explanation"),o.find(".dialogForm"),o.find(".tile.template")),c=(o.find(".deleteOverlayContainer.template"),t(d)),p=DialogInput.getProperties(l.inputFields);this.CardTile=function(t){t=t||{};var a=d.clone().removeClass("template"),o=l.data;i(o,t.site,p),n(o,t.site,p);s.append(a),e(a,t.site?t.site.getFormData(c):o.defaultData),l.tiles.push(this)};switch(r.type){case"CreditCard":Dialog.prototype.setup.apply(this,arguments),"update"===r.action?this.setupUpdate(r):this.setupAdd(r)}},CardDialog.prototype.setSelectable=function(t){},CardDialog.prototype.validate=function(t){},CardDialog.prototype.getDialogActions=function(t){},CardDialog.prototype.close=function(t){bg.LPTabState.clear({force:!0}),DialogWithGroupInput.prototype.close.apply(this,arguments)},CardDialog.prototype.open=function(t){var e=this;DialogWithGroupInput.prototype.open.call(e,t)},CardDialog.prototype.adjustScrollHeight=function(t){this.scrollHeight&&(this.scrollHeight+=t,this.tileContainer.css({"max-height":this.scrollHeight}))},CardDialog.prototype.setInitialScrollHeight=function(){if(this.tiles.length>3){this.tileContainer=this.$element.find(".tileContainer");var t=this.tileContainer.height(),e=this.$element.find(".tile").first().height(),i=(t-e*this.tiles.length)/(this.tiles.length-1);this.scrollHeight=3.5*e+3*i,this.tileContainer.css({overflow:"auto","max-height":this.scrollHeight})}},CardDialog.prototype.showInitial=function(){!function(t){t.requestAnimationFrame(function(e){t.show(),t.setInitialScrollHeight(),t.$element.addClass("animate-enter").one("animationend",function(){t.$element.removeClass("animate-enter"),e()})})}(this)};var o=null,r=!1;CardDialog.prototype.showInProcessOverlay=function(){if(this.submitted){var t=this.$element;t.addClass("inProcess").one("animationend",function(){t.addClass("waiting"),setTimeout(function(){r=!0,o&&o()},500)})}},CardDialog.prototype.hideInProcessOverlay=function(){this.$element.removeClass("inProcess waiting")},CardDialog.prototype.closeOnSuccess=function(){},CardDialog.prototype.performValidate=function(t){},CardDialog.prototype.getErrorOptions=function(){return{static:!0,alignTop:!0,showErrorLabel:!1}},CardDialog.prototype.submit=function(){},CardDialog.prototype.handleSubmit=function(t){}}();